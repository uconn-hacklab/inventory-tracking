# Check for the platform
set(PLATFORM "EMBEDDED")

if(PLATFORM STREQUAL "EMBEDDED")
    set(ENDIANNESS "BIG")
    # include(${CMAKE_SOURCE_DIR}/../arch/ARM/ixp42x/module.cmake) TODO does not appear this is necessary
    # set(STRIP "${TOOLS_PATH}/strip" CACHE STRING "Strip Tool" FORCE)
else()
    message(FATAL_ERROR "Unsupported platform")
endif()

# Serial Reader Only
# Automatically defined if is BARE_METAL
if(TMR_ENABLE_SERIAL_READER_ONLY OR TMR_ENABLE_HF_LF)
    set(SERIAL_READER_ONLY 1)
endif()

# Output Libraries
# TODO might not be necessary
#set(STATIC_LIB "libmercuryapi.a")
#set(SHARED_LIB "libmercuryapi.so.1")

# Source files
set(SOURCES
    # generated by esp-idf
    mercury_api.c

    # platform specific sources
    serial_transport_esp32.c
    osdep_esp32.c

    # platform independent sources
    tmr_strerror.c
    tmr_param.c
    hex_bytes.c
    tm_reader.c
    # tm_reader_async.c TODO might not be necessary
    serial_reader.c
    tmr_loadsave_configuration.c
    serial_reader_l3.c
    tmr_utils.c
)

set(FREERTOS_USED)
idf_component_register(SRCS ${SOURCES} 
                       INCLUDE_DIRS "include")


